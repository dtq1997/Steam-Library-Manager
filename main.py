"""
╔══════════════════════════════════════════════════════════════════════════════╗
║                   STEAM LIBRARY MANAGER (Steam 收藏夹管理助手)               ║
╚══════════════════════════════════════════════════════════════════════════════╝
================================================================================
【AI 协作系统提示词 / System Prompt for AI Maintainers】
如果你（AI）正在处理本项目，请务必遵守以下开发者习惯与规则：

【确认机制】
※ 如果你（AI）已完整阅读本导言区，并同意严格按照以下所有规则执行，
  请在后续回复中首先向用户确认："已阅读导言区提示词，将严格按照规则执行。"
  之后再进行具体的讨论或操作。

【元规则 - 最高优先级】
0. 【提示词协作】：允许 AI 根据与用户的交流情况，自发在本导言区增加或修改提示词，
   但每次增加或修改提示词前必须先与用户讨论并获得同意。
   AI 必须严格遵照本导言区的所有提示词运作，本导言区规则优先级最高。
   【主动更新】：如果用户提出的需求反映了某些更具一般性的要求，AI 应主动将其整合
   为新的规则添加到本导言区，并在回复中明确告知用户具体修改了哪些内容。
   【及时响应】：当用户明确要求修改导言区内容时，AI 必须立即配合执行修改，
   不得拖延或遗漏。导言区是用户与 AI 之间的"协作契约"，保持其准确和最新
   是最高优先级任务之一。

================================================================================
【项目架构 / Project Architecture】
================================================================================
本项目已从单文件重构为多模块架构。以下是当前文件结构及各模块职责：
（注意：架构可能随开发演进而变化，请以实际文件为准，并在变更时更新本节。）

  main.py              ← 你现在所在的文件。程序入口 + 导言区提示词。
  │                      只负责启动，不含业务逻辑。
  │
  ├── ui.py            ← 所有 tkinter 界面代码。
  │   │                  包含两个类：
  │   │                  · SteamToolbox        — 主窗口（持有 self.core 调用业务逻辑）
  │   │                  · SteamToolboxIntro   — 启动时的账号选择界面
  │   │
  │   ├── core.py      ← 核心业务逻辑（UI 无关）。
  │   │                  包含 SteamToolboxCore 类：网络请求、数据抓取、
  │   │                  JSON 读写、IGDB API、Cookie 管理、收藏夹操作等。
  │   │                  ⚠️ 目前仍有 from tkinter import messagebox 的残留依赖，
  │   │                  理想情况下应改为抛异常/返回错误，由 ui.py 处理展示。
  │   │
  │   ├── account_manager.py  ← Steam 账号发现与管理。
  │   │                  · SteamAccount    — 账号数据类（路径、ID3、昵称）
  │   │                  · SteamDiscovery  — 自动扫描系统中的 Steam 账号
  │   │                  依赖第三方库 vdf（用于正规解析 Valve Data Format 配置文件）。
  │   │
  │   ├── local_storage.py    ← 备份管理器。
  │   │                  · BackupManager   — 创建/恢复/删除/对比备份
  │   │
  │   └── spiders.py   ← 爬虫模块（预留扩展位）。
  │                      · IGDBSpider      — 目前为占位符，未来可从 core.py
  │                                          中拆出 IGDB 相关爬虫逻辑。
  │
  └── vdf/             ← 内置的第三方库（MIT 许可证，ValvePython/vdf v3.4）。
      ├── __init__.py    解析 Valve Data Format 配置文件
      ├── vdict.py       VDF 专用有序字典
      └── LICENSE        许可证文件

【模块间调用关系】
  main.py → ui.SteamToolboxIntro.intro_ui()
          → ui.SteamToolbox(account, callback)
             └── self.core = core.SteamToolboxCore(account)
                              └── self.backup_manager = local_storage.BackupManager(...)

【第三方依赖】
  · 无。vdf 库（解析 Steam 的 localconfig.vdf 配置文件以读取用户昵称）已作为
    本地模块内置在 vdf/ 文件夹中（MIT 许可证，来源 github.com/ValvePython/vdf
    v3.4），无需 pip install，开箱即用。

【修改指南 - 给 AI 的】
  · 改界面/交互 → 编辑 ui.py
  · 改数据抓取/业务逻辑 → 编辑 core.py
  · 改账号扫描/检测 → 编辑 account_manager.py
  · 改备份功能 → 编辑 local_storage.py
  · 添加新爬虫 → 编辑 spiders.py 或新建模块
  · 改导言区规则 → 编辑本文件 main.py

================================================================================
【项目目标】
================================================================================
Steam Library Manager 是一款为"游戏收藏家"设计的 Steam 收藏夹批量管理工具。
通过直接读写 Steam 本地配置文件 cloud-storage-namespace-1.json
（位于 userdata/<SteamID3>/config/cloudstorage/）来管理收藏夹。
支持通过鉴赏家、排行榜及 IGDB 游戏数据库批量生成和管理游戏收藏夹。

为确保触发云同步，程序会在收藏夹名称末尾附加提示文字"(删除这段字以触发云同步)"，
手动删除该后缀即可触发 Steam 的云同步机制。

================================================================================
【开发规范】
================================================================================
1. 【逻辑稳定性】：核心功能（JSON 读写、AppID 正则提取）严禁在非必要情况下改动。
2. 【改动确认】：在尝试重构现有功能或大规模调整 UI 前，必须获得用户明确许可。
3. 【更新逻辑】：更新功能（无论是 TXT 还是鉴赏家）必须采用"增量"模式：
   - 主收藏夹：原有 ID + 新增 ID（去重）。
   - 必须创建两个辅助收藏夹："[原名] - 比旧版多的" 和 "[原名] - 比旧版少的"。
   - 【无新增时跳过】：如果更新后没有新增任何游戏，应提示"该列表已是最新"，
     不执行任何操作（不修改主收藏夹、不创建辅助收藏夹）。
4. 【命名规范】：所有通过程序创建或更新的收藏夹名称必须强制添加后缀：
   "(删除这段字以触发云同步)"。
5. 【UI 习惯】：功能按钮的排列顺序保持为：[导入]、[导出]、[更新]。
6. 【反馈机制】：操作完成后必须显示录入/差异数量，并附带数目对不上的免责注记。
7. 【UI 文本风格】：
   - 窗口标题：动宾结构，如"同步 Steam 鉴赏家游戏列表"
   - 使用指南：格式为"使用指南：\n1. xxx\n2. xxx"
   - 状态反馈：✅ 表示成功，❌ 表示失败
   - 按钮文字：emoji + 动宾结构，如"📁 建立为新收藏夹"
   - 说明列表：使用"• "开头
   - 关键信息：使用红色高亮
   - 保持简洁，避免冗余描述
8. 【网络请求】：macOS 需禁用 SSL 证书验证以解决证书问题。
9. 【备份机制】：修改原文件前必须先创建备份，备份存储在 json 同目录的 backups/
   文件夹中。
10.【账号管理】：程序启动时自动扫描所有 Steam 账号，支持多账号切换，
   始终高亮当前账号。
11.【窗口大小】：所有窗口必须自适应内容大小，禁止使用固定的 geometry() 设置
   窗口尺寸。
12.【全局配置】：需要跨功能共享的配置项（如 Cookie）应在主界面提供统一的管理入口，
   并在所有相关子功能中全局调用。子功能界面应显示该配置项的当前状态，
   并说明配置后的效果。
13.【主界面布局规范】：主界面采用紧凑布局，减少不必要的空间浪费，具体要求如下：
   a) 收藏夹列表置左，与 Steam 客户端侧边栏风格一致。功能控制区在右侧。
   b) "💾 管理收藏夹备份"按钮放在"📂 当前收藏夹"标题旁边（同一行）。
   c) "🔑 管理登录态 Cookie" 和 "🎮 管理 IGDB API 凭证" 两个按钮并排放置。
   d) 避免按钮独占整行、说明文字过多导致界面冗长的情况。
14.【增量修改】：生成代码时必须基于现有代码进行增量修改，严禁重新生成整个文件
   或整个方法。应只输出需要变动的部分（如使用 diff/patch 或明确标注修改区域），
   以节省 token 开销。
15.【跨平台】：支持 Windows / macOS / Linux / WSL。
16.【版本管理】：每次生成新版本时，必须递增版本号并在导言区更新日志中
   添加对应条目，版本号格式为 vX.Y 或 vX.Y.Z。
17.【弹窗置顶】：所有弹窗（messagebox、simpledialog、Toplevel 子窗口）必须始终
   置顶显示。已通过 ui.py 中的 _patch_dialogs_topmost() 全局补丁实现，
   新增弹窗类型时需确保纳入补丁范围。

================================================================================
【更新日志】
================================================================================
2026-02-10  v2.0.2 — 弹窗置顶修复：
                    - 所有弹窗（messagebox / simpledialog / Toplevel 子窗口）
                      统一强制置顶显示，解决对话框被主窗口遮挡无法操作的问题
                    - 通过 ui.py 启动时的全局 monkey-patch 实现，共覆盖 78 处调用，
                      无需逐个修改
2026-02-10  v2.0.1 — 内置 vdf 库，消除外部依赖：
                    - 将 vdf 库 (v3.4) 作为本地模块内置在 vdf/ 文件夹中
                    - 用户无需执行 pip install，下载即可直接运行
2026-02-10  v2.0 — 多模块架构重构（由热心人协助完成）：
                    - 从单文件 Steam_Library_Manager.py (4230行) 重构为 6 个模块
                    - 业务逻辑与 UI 分离：core.py (逻辑) + ui.py (界面)
                    - 账号管理独立为 account_manager.py，引入 SteamAccount 数据类
                    - 备份管理独立为 local_storage.py
                    - 引入 vdf 库替代正则解析 localconfig.vdf，更可靠
                    - 预留 spiders.py 爬虫扩展位
                    - 功能与原版完全一致，无功能增减

================================================================================
"""

from ui import SteamToolboxIntro

if __name__ == "__main__":
    app = SteamToolboxIntro()
    app.intro_ui()
